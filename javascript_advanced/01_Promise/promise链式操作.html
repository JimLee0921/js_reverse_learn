<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        function test() {
            return new Promise(function (resolve, reject) {
                console.log("ğŸ“¡ Step 1: å‘é€Ajaxè¯·æ±‚...");

                setTimeout(function () {
                    const responseCode = Math.random() > 0.5 ? 200 : 500;

                    if (responseCode === 200) {
                        const data = {
                            code: 200,
                            message: "è¯·æ±‚æˆåŠŸ",
                            data: {username: "Jim", age: 24}
                        };
                        console.log("âœ… Step 2: è¯·æ±‚æˆåŠŸï¼");
                        resolve(data);
                    } else {
                        reject("âŒ Step 2: è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ä¸º 500");
                    }
                }, 2000); // æ—¶é—´è°ƒçŸ­ç‚¹æ–¹ä¾¿æµ‹è¯•
            });
        }

        function processData(data) {
            return new Promise(function (resolve) {
                console.log("ğŸ” Step 3: å¤„ç†æ•°æ®...");
                const username = data.data.username;
                resolve(username);
            });
        }

        function saveData(username) {
            return new Promise(function (resolve) {
                console.log(`ğŸ’¾ Step 4: æ­£åœ¨ä¿å­˜ ${username} çš„æ•°æ®...`);
                setTimeout(() => {
                    console.log(`âœ… Step 5: ${username} çš„æ•°æ®ä¿å­˜æˆåŠŸï¼`);
                    resolve();
                }, 1000);
            });
        }

        // ğŸ”— Promise é“¾å¼è°ƒç”¨
        test()
            .then(res => processData(res))       // å¤„ç†æ•°æ®
            .then(username => saveData(username)) // ä¿å­˜æ•°æ®
            .then(() => {
                console.log("ğŸ‰ Step 6: æ‰€æœ‰æ“ä½œå®Œæˆï¼");
            })
            .catch(err => {
                console.error("ğŸ”¥ é”™è¯¯å‘ç”Ÿ:", err);
            });

    </script>
</head>
<body>

</body>
</html>