# -*- coding: UTF-8 -*-
# author: LT
# date: 2025/03/24
"""
主要是靠 JS 扣代码 网址: https://music.163.com/
"""
import execjs
import requests

params = {
    "ids": "[1838634780]",
    "level": "standard",
    "encodeType": "aac",
    # "csrf_token": "fa3fad60a189784c4df1d2cf049ad2d7"
}
cookies = {
    'NMTID': '00OnVE4TCkCY-V2BEyXqBjBvY6_JdoAAAGVxwTswg',
    '_iuqxldmzr_': '32',
    '_ntes_nnid': '6ed068359c204e0b29b3506ca8fd3f1e,1742800745390',
    '_ntes_nuid': '6ed068359c204e0b29b3506ca8fd3f1e',
    'WEVNSM': '1.0.0',
    'WNMCID': 'asadph.1742800745723.01.0',
    'ntes_utid': 'tid._.65IsNaDnRM9FE0VFBRLXJrFuEXDqPZnV._.0',
    'WM_NI': 'bbutQlWmfEyuoUG3H4xPamrg4IoIAOSM84I5GUNYL%2Bjv3SZfN%2FC4oJo7M4sR6jD2i7g2VyvG55hBAuNgHcvCKSjCevJF885jqWMdn2EzHCmUVgdL18dYyNFJN9i7ikVKdVI%3D',
    'WM_NIKE': '9ca17ae2e6ffcda170e2e6ee8eb16b85efadadd96287a88fa7d44e868e8fb1cb47b38ebeb2d744b390a886fb2af0fea7c3b92aa2bebb95d46895b3aaa6fc7fad8b89d4cb40bc90af8ef16df897a1aac4459193f8d5cc3f858b82bacf21aaaafdb4d96e8ef18dd5ee42ade983d5f25af6b68cd3ec3da5ee9a9af54df7eba8a3c47f8eb98884f549898da6a4e87e8a9af8d9b862b3898385ed3a87a688a4f05f96b9acadb434a887b7afc5428ee7a7d8ec619695acb7cc37e2a3',
    'sDeviceId': 'YD-1%2BPFWJ8b2GlFVlUAEVfCJqB%2BRHSrOd2Q',
    'JSESSIONID-WYYY': '7VIEp52Z%2F%2FtuhFqVnNGgiffdySfglxaKAzDgfobzr4jefcs95cy3nG4ndd0Os7XqlzkCiHQAr4uq5mad5gQ%2B3wekTw%5C5uq5MQ%2FpH6PnqfOVVXaGFcfkH%5CxDpPEPPpZI6uvwTSE8Z1bGqIow8BitMhRTgessTXnVVTnBfpHDt4Ad%5CJu8q%3A1742804285817',
    '__snaker__id': 'a0bVdOPnJ8m6XMP8',
    'WM_TID': 'o%2BN%2FuXystdhAQBQBQEeHJ%2FQvETCvKeEl',
    'gdxidpyhxdE': '7yyIGeIXHZo%2FuoYzaMTRZGpgArB7vlhS9qMcdAHiwktkiHSfRC8qKgvRqkhpl0X1M%2FmUV%2F8MCyYrGPqC4gVCw3mhd2%2BZWG8cdHOC%2FlYJEHMv5%5Ccs14PlIiL0UI8%2Bm6S3Czy4HW760%2FP9CTUOu%2F0RmkO03pCdQQ4Nmj7w0iQfh2%5CTEc%2BE%3A1742803693737',
    '__remember_me': 'true',
    '__csrf': 'fa3fad60a189784c4df1d2cf049ad2d7',
    'MUSIC_U': '0014589174E05615A34CACF9F444C5AE477F116ED8E7141E89D108CD9FC82F37C71AD33AADF7CF63BF69731AB6D7CA4CE2A2F68407A6E9A56359BAF0F8F5BF5FC43597A74C2B3ABA8F80A02E4DEC2A94885BD4A953A9072C4922143133D38BB573C8B0567C457E272F3351C9AC07858C12BE51D5E72FCC0C1FCD9141FCEF326A297B58815B64C2B9C18E61BA5878D62887FD6F53CEB87FEFA138BB4EEA17B0A809B9B9B06F8B53C174A7D7EF2B121FB9E766BED01FC02A6BEF3C28F2E4AFC0CF47AD58F0AEED1EA176AA7AE9D91883AA03DD34DFBC8952964F0AF724EA90EAC260E0EC37C698B93AE61BF34F99002659352BD73038EC37107F7830B6B8CB39D91B4C1F1449E8D41E4DFBDCAF086A778C77248899EB46AE68C85BC944F56913A2FDD716D9F9D6F0E4B1ED80602C9059EF758757F2517926510BB8C1BF6EA018BB248622371FCD4226726098AF081351B76B1507DB6410E84D67D18AF4096844E514',
    'ntes_kaola_ad': '1',
    'playerid': '39267480',
}

headers = {
    'accept': '*/*',
    'accept-language': 'zh-CN,zh;q=0.9',
    'cache-control': 'no-cache',
    'content-type': 'application/x-www-form-urlencoded',
    'origin': 'https://music.163.com',
    'pragma': 'no-cache',
    'priority': 'u=1, i',
    'referer': 'https://music.163.com/',
    'sec-ch-ua': '"Chromium";v="134", "Not:A-Brand";v="24", "Google Chrome";v="134"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Windows"',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36',
    # 'cookie': 'NMTID=00OnVE4TCkCY-V2BEyXqBjBvY6_JdoAAAGVxwTswg; _iuqxldmzr_=32; _ntes_nnid=6ed068359c204e0b29b3506ca8fd3f1e,1742800745390; _ntes_nuid=6ed068359c204e0b29b3506ca8fd3f1e; WEVNSM=1.0.0; WNMCID=asadph.1742800745723.01.0; ntes_utid=tid._.65IsNaDnRM9FE0VFBRLXJrFuEXDqPZnV._.0; WM_NI=bbutQlWmfEyuoUG3H4xPamrg4IoIAOSM84I5GUNYL%2Bjv3SZfN%2FC4oJo7M4sR6jD2i7g2VyvG55hBAuNgHcvCKSjCevJF885jqWMdn2EzHCmUVgdL18dYyNFJN9i7ikVKdVI%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6ee8eb16b85efadadd96287a88fa7d44e868e8fb1cb47b38ebeb2d744b390a886fb2af0fea7c3b92aa2bebb95d46895b3aaa6fc7fad8b89d4cb40bc90af8ef16df897a1aac4459193f8d5cc3f858b82bacf21aaaafdb4d96e8ef18dd5ee42ade983d5f25af6b68cd3ec3da5ee9a9af54df7eba8a3c47f8eb98884f549898da6a4e87e8a9af8d9b862b3898385ed3a87a688a4f05f96b9acadb434a887b7afc5428ee7a7d8ec619695acb7cc37e2a3; sDeviceId=YD-1%2BPFWJ8b2GlFVlUAEVfCJqB%2BRHSrOd2Q; JSESSIONID-WYYY=7VIEp52Z%2F%2FtuhFqVnNGgiffdySfglxaKAzDgfobzr4jefcs95cy3nG4ndd0Os7XqlzkCiHQAr4uq5mad5gQ%2B3wekTw%5C5uq5MQ%2FpH6PnqfOVVXaGFcfkH%5CxDpPEPPpZI6uvwTSE8Z1bGqIow8BitMhRTgessTXnVVTnBfpHDt4Ad%5CJu8q%3A1742804285817; __snaker__id=a0bVdOPnJ8m6XMP8; WM_TID=o%2BN%2FuXystdhAQBQBQEeHJ%2FQvETCvKeEl; gdxidpyhxdE=7yyIGeIXHZo%2FuoYzaMTRZGpgArB7vlhS9qMcdAHiwktkiHSfRC8qKgvRqkhpl0X1M%2FmUV%2F8MCyYrGPqC4gVCw3mhd2%2BZWG8cdHOC%2FlYJEHMv5%5Ccs14PlIiL0UI8%2Bm6S3Czy4HW760%2FP9CTUOu%2F0RmkO03pCdQQ4Nmj7w0iQfh2%5CTEc%2BE%3A1742803693737; __remember_me=true; __csrf=fa3fad60a189784c4df1d2cf049ad2d7; MUSIC_U=0014589174E05615A34CACF9F444C5AE477F116ED8E7141E89D108CD9FC82F37C71AD33AADF7CF63BF69731AB6D7CA4CE2A2F68407A6E9A56359BAF0F8F5BF5FC43597A74C2B3ABA8F80A02E4DEC2A94885BD4A953A9072C4922143133D38BB573C8B0567C457E272F3351C9AC07858C12BE51D5E72FCC0C1FCD9141FCEF326A297B58815B64C2B9C18E61BA5878D62887FD6F53CEB87FEFA138BB4EEA17B0A809B9B9B06F8B53C174A7D7EF2B121FB9E766BED01FC02A6BEF3C28F2E4AFC0CF47AD58F0AEED1EA176AA7AE9D91883AA03DD34DFBC8952964F0AF724EA90EAC260E0EC37C698B93AE61BF34F99002659352BD73038EC37107F7830B6B8CB39D91B4C1F1449E8D41E4DFBDCAF086A778C77248899EB46AE68C85BC944F56913A2FDD716D9F9D6F0E4B1ED80602C9059EF758757F2517926510BB8C1BF6EA018BB248622371FCD4226726098AF081351B76B1507DB6410E84D67D18AF4096844E514; ntes_kaola_ad=1; playerid=39267480',
}

with open("./main.js", mode="r", encoding="utf-8") as f:
    js_code = f.read()
    ctx = execjs.compile(js_code)
    result = ctx.call("encrypt", params)
    data = {
        "params": result['encText'],
        "encSecKey": result['encSecKey']
    }
response = requests.post(url="https://music.163.com/weapi/song/enhance/player/url/v1", data=data, headers=headers,
                         cookies=cookies)
print(response.text)

music_download_url = response.json()['data'][0]['url']
print(music_download_url)
